<div class="detail-page">
  <pxs-detail-header [asset]="asset"></pxs-detail-header>
  <div class="detail-main-content">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <pxs-chart 
            style="display: flex; height: 100%;"
            [loading]="chartIsLoading"
            [height]="400"
            [title]="'Data'"
            [chartData]="chartData"
            (updateChartData)="updateChartData($event)"
            [filter]="currentFilter"
            [drpOptions]="drpOptions"
            (download)="downloadPdfDetail()"
            [asset]="asset"
            #myChart
          ></pxs-chart>
        </div>
      </div>
      <div class="row" *ngIf="chartData && !chartIsLoading && currentFilter.durationInHours > 24">
        <div class="col-12">
          <pxs-aggregated-values *ngIf="!sdIsLoading" [standardDeviations]="standardDeviations" #myAggregatedValues></pxs-aggregated-values>
        </div> 
      </div>
      <div class="row">
        <div class="col-lg-8 col-md-7">
          <pxs-map-asset *ngIf="asset" [height]="400" [assets]="[asset]"></pxs-map-asset>
        </div>
        <div class="col-lg-4 col-md-5">
          <div id="asset-image" [style.background-image]="'url('+asset?.pictureBase64+')'"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-8 col-md-7">
          <pxs-threshold-templates-detail [thresholdTemplate]="MOCK_THRESHOLD_TEMPLATE"></pxs-threshold-templates-detail>
        </div>
        <div class="col-lg-4 col-md-5">
          <div class="last-alert-container" *ngIf="lastAlert">
            <span class="last-alert-title">{{'DETAIL.LAST_ALERT.TITLE' | translate}}</span>
            <div class="last-alert-wrapper">
              <img
                [src]="'assets/smartmonitoring/images/icons/icon-'+ lastAlert.thresholdAlert.sensorType.name + '-white.svg'"
                alt="">
              <div class="last-alert-content">
                <span class="last-alert-description">
                  {{'SENSORTYPES.' + lastAlert?.thresholdAlert?.sensorType?.name | translate}}
                  {{alertsService.getAlertType(lastAlert.sensorReading.value, lastAlert.thresholdAlert.high, lastAlert.thresholdAlert.low) | translate}}
                  <br>
                  <span class="last-alert-date">
                    {{lastAlert.sensorReading.timestamp | date : 'short'}}
                  </span>
                </span>
              </div>
            </div>
            <div class="last-alert-values">
              <div class="last-alert-value">
                <span>{{'DETAIL.LAST_ALERT.VALUE' | translate}}</span>
                <span>{{lastAlert.sensorReading.value}}{{lastAlert.thresholdAlert.sensorType.postfix}}</span>
              </div>
              <div class="last-alert-value"
                   [ngClass]="{'background-error':lastAlert.sensorReading.value < lastAlert.thresholdAlert.low }">
                <span>{{'DETAIL.LAST_ALERT.LOW' | translate}}</span>
                <span>{{lastAlert.thresholdAlert.low}}{{lastAlert.thresholdAlert.sensorType.postfix}}</span>
              </div>
              <div class="last-alert-value"
                   [ngClass]="{'background-error':lastAlert.sensorReading.value > lastAlert.thresholdAlert.low }">
                <span>{{'DETAIL.LAST_ALERT.HIGH' | translate}}</span>
                <span>{{lastAlert.thresholdAlert.high}}{{lastAlert.thresholdAlert.sensorType.postfix}}</span>
              </div>
            </div>
            <div class="last-alert-actions" *ngIf="numberOfAlertsOfTheDay > 0">
              <mat-spinner-button (btnClick)="exportAlerts()" [options]="btnOptsExportAlerts"></mat-spinner-button>
            </div>
          </div>
          <!--
          <div class="detail-thresholds">
            <h6>
              {{asset?.thresholdTemplate?.isCustom ? 'Custom' : asset?.thresholdTemplate?.name}}
            </h6>
            <div *ngFor="let item of asset?.thresholdTemplate?.thresholds">
              <span>{{'SENSORTYPES.' + item.sensorType?.name | translate}}</span>
              <pxs-range-slider
                [min]="item.sensorType?.min"
                [max]="item.sensorType?.max"
                [startFrom]="item.low"
                [startTo]="item.high"
                [postfix]="item.sensorType?.postfix"
                [disabled]="true">
              </pxs-range-slider>
            </div>
          </div>
          -->
        </div>
      </div>
    </div>
  </div>
</div>
